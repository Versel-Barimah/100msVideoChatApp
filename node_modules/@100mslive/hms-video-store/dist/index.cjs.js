var Lt=Object.create;var Q=Object.defineProperty,xt=Object.defineProperties,Ot=Object.getOwnPropertyDescriptor,wt=Object.getOwnPropertyDescriptors,Nt=Object.getOwnPropertyNames,Je=Object.getOwnPropertySymbols,Ut=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var Qe=(s,e,t)=>e in s?Q(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,N=(s,e)=>{for(var t in e||(e={}))Ye.call(e,t)&&Qe(s,t,e[t]);if(Je)for(var t of Je(e))_t.call(e,t)&&Qe(s,t,e[t]);return s},F=(s,e)=>xt(s,wt(e)),Xe=s=>Q(s,"__esModule",{value:!0});var Kt=(s,e)=>{Xe(s);for(var t in e)Q(s,t,{get:e[t],enumerable:!0})},Vt=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Nt(e))!Ye.call(s,r)&&r!=="default"&&Q(s,r,{get:()=>e[r],enumerable:!(t=Ot(e,r))||t.enumerable});return s},I=s=>Vt(Xe(Q(s!=null?Lt(Ut(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var l=(s,e,t)=>new Promise((r,o)=>{var i=M=>{try{c(t.next(M))}catch(R){o(R)}},a=M=>{try{c(t.throw(M))}catch(R){o(R)}},c=M=>M.done?r(M.value):Promise.resolve(M.value).then(i,a);c((t=t.apply(s,e)).next())});Kt(exports,{HMSAudioPluginType:()=>n.HMSAudioPluginType,HMSLogLevel:()=>n.HMSLogLevel,HMSMessageType:()=>Te,HMSNotificationSeverity:()=>P,HMSNotificationTypes:()=>h,HMSPlaylistType:()=>p,HMSReactiveStore:()=>x,HMSRoomState:()=>H,HMSStats:()=>ne,HMSVideoPluginType:()=>n.HMSVideoPluginType,createDefaultStatsStore:()=>z,createDefaultStoreState:()=>X,parsedUserAgent:()=>n.parsedUserAgent,selectAudioPlaylist:()=>Oe,selectAudioPlaylistTrackByPeerID:()=>ks,selectAudioTrackByPeerID:()=>pt,selectAudioTrackVolume:()=>Be,selectAudioVolumeByPeerID:()=>bs,selectAuxiliaryAudioByPeerID:()=>Hs,selectAuxiliaryTracksByPeerID:()=>ms,selectAvailableRoleNames:()=>is,selectBroadcastMessages:()=>Tt,selectBroadcastMessagesUnreadCount:()=>xs,selectCameraStreamByPeerID:()=>ps,selectDegradedTracks:()=>ss,selectDevices:()=>$t,selectDidIJoinWithin:()=>Xs,selectDominantSpeaker:()=>Yt,selectHLSState:()=>ls,selectHMSMessages:()=>se,selectHMSMessagesCount:()=>Ee,selectHMSStats:()=>bt,selectIsAllowedToPublish:()=>js,selectIsAllowedToSubscribe:()=>as,selectIsAudioLocallyMuted:()=>Ve,selectIsConnectedToRoom:()=>rt,selectIsInPreview:()=>os,selectIsLocalAudioEnabled:()=>Qt,selectIsLocalAudioPluginPresent:()=>Js,selectIsLocalScreenShared:()=>ue,selectIsLocalVideoDisplayEnabled:()=>be,selectIsLocalVideoEnabled:()=>de,selectIsLocalVideoPluginPresent:()=>Gs,selectIsLocallyMutedByPeerID:()=>vs,selectIsPeerAudioEnabled:()=>Rs,selectIsPeerVideoEnabled:()=>Is,selectIsScreenShareLocallyMutedByPeerID:()=>Ds,selectIsSomeoneScreenSharing:()=>Xt,selectLocalAudioTrackID:()=>C,selectLocalMediaSettings:()=>ve,selectLocalPeer:()=>A,selectLocalPeerID:()=>q,selectLocalPeerRole:()=>re,selectLocalTrackIDs:()=>De,selectLocalVideoTrackID:()=>L,selectMessageIDsInOrder:()=>Ie,selectMessagesByPeerID:()=>Os,selectMessagesByRole:()=>ws,selectMessagesMap:()=>Re,selectMessagesUnreadCountByPeerID:()=>Us,selectMessagesUnreadCountByRole:()=>Ns,selectPeerAudioByID:()=>Ts,selectPeerByCondition:()=>Ys,selectPeerByID:()=>O,selectPeerCount:()=>Wt,selectPeerMetadata:()=>Ks,selectPeerNameByID:()=>Ms,selectPeerScreenSharing:()=>ot,selectPeerSharingAudio:()=>zt,selectPeerSharingAudioPlaylist:()=>ts,selectPeerSharingVideoPlaylist:()=>es,selectPeers:()=>W,selectPeersByCondition:()=>Qs,selectPeersByRole:()=>_s,selectPeersMap:()=>D,selectPeersScreenSharing:()=>Zt,selectPeersWithAudioStatus:()=>Vs,selectPermissions:()=>Ce,selectRTMPState:()=>cs,selectRecordingState:()=>ns,selectRemotePeers:()=>Jt,selectRoleByRoleName:()=>$s,selectRoleChangeRequest:()=>qs,selectRolesMap:()=>K,selectRoom:()=>v,selectRoomID:()=>jt,selectRoomStartTime:()=>ds,selectRoomStarted:()=>Ae,selectRoomState:()=>b,selectScreenShareAudioByPeerID:()=>Ke,selectScreenShareByPeerID:()=>Ps,selectScreenSharesByPeerId:()=>_e,selectScreenshareAudioVolumeByPeerID:()=>Es,selectSessionId:()=>Ss,selectSimulcastLayerByTrack:()=>As,selectSpeakers:()=>st,selectTrackAudioByID:()=>hs,selectTrackByID:()=>ie,selectTracksMap:()=>y,selectUnreadHMSMessagesCount:()=>rs,selectVideoPlaylist:()=>we,selectVideoPlaylistAudioTrackByPeerID:()=>fs,selectVideoPlaylistVideoTrackByPeerID:()=>ys,selectVideoTrackByPeerID:()=>Mt});var Et=I(require("immer")),At=I(require("zustand/vanilla")),Ct=I(require("zustand/shallow")),ge=I(require("@100mslive/hms-video"));var H;(function(c){c.Disconnected="Disconnected",c.Preview="Preview",c.Connecting="Connecting",c.Connected="Connected",c.Reconnecting="Reconnecting",c.Disconnecting="Disconnecting",c.Failed="Failed"})(H||(H={}));var X=()=>({room:{id:"",isConnected:!1,name:"",peers:[],shareableLink:"",localPeer:"",hasWaitingRoom:!1,roomState:H.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}),z=()=>({peerStats:{},trackStats:{},localPeer:{id:""}});var Te;(function(e){e.CHAT="chat"})(Te||(Te={}));var P;(function(r){r.INFO="info",r.ERROR="error",r.CRITICAL="critical"})(P||(P={}));var h;(function(S){S.PEER_JOINED="PEER_JOINED",S.PEER_LEFT="PEER_LEFT",S.PEER_LIST="PEER_LIST",S.NEW_MESSAGE="NEW_MESSAGE",S.ERROR="ERROR",S.RECONNECTING="RECONNECTING",S.RECONNECTED="RECONNECTED",S.TRACK_ADDED="TRACK_ADDED",S.TRACK_REMOVED="TRACK_REMOVED",S.TRACK_MUTED="TRACK_MUTED",S.TRACK_UNMUTED="TRACK_UNMUTED",S.TRACK_DEGRADED="TRACK_DEGRADED",S.TRACK_RESTORED="TRACK_RESTORED",S.ROLE_CHANGE_REQUEST="ROLE_CHANGE_REQUEST",S.ROLE_UPDATED="ROLE_UPDATED",S.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",S.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",S.ROOM_ENDED="ROOM_ENDED",S.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",S.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",S.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",S.NAME_UPDATED="NAME_UPDATED",S.METADATA_UPDATED="METADATA_UPDATED"})(h||(h={}));var p;(function(t){t.audio="audio",t.video="video"})(p||(p={}));var n=I(require("@100mslive/hms-video"));var _=I(require("@100mslive/hms-video"));var ze=(s,e)=>{let t=Pe(Object.keys(s),Object.keys(e));for(let r of t){let o=s[r],i=e[r];ye(o,i)?(U(o.auxiliaryTracks,i.auxiliaryTracks)&&(i.auxiliaryTracks=o.auxiliaryTracks),Object.assign(o,i)):fe(o,i)?delete s[r]:ke(o,i)&&(s[r]=i)}},Ze=(s,e)=>{let t=Pe(Object.keys(s),Object.keys(e));for(let r of t){let o=s[r],i=e[r];ye(o,i)?(Bt(o,i),Object.assign(o,i)):fe(o,i)?delete s[r]:ke(o,i)&&(s[r]=i)}},He=(s,e)=>{let t=Pe(Object.keys(s),Object.keys(e));for(let r of t){let o=s[r],i=e[r];ye(o,i)?Object.assign(o,i):fe(o,i)?delete s[r]:ke(o,i)&&(s[r]=i)}},Bt=(s,e)=>{s.plugins&&U(s.plugins,e.plugins)&&(e.plugins=s.plugins),s.layerDefinitions&&U(s.layerDefinitions,e.layerDefinitions)&&(e.layerDefinitions=s.layerDefinitions)},ye=(s,e)=>s&&e,fe=(s,e)=>s&&!e,ke=(s,e)=>!s&&e,U=(s,e)=>{if(s===e||s.length===0&&(e==null?void 0:e.length)===0)return!0;if(!s||!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0},Pe=(s,e)=>{let t=new Set;for(let r of s)t.add(r);for(let r of e)t.add(r);return Array.from(t)};var g=class{static convertPeer(e){var t,r,o;return{id:e.peerId,name:e.name,roleName:(t=e.role)==null?void 0:t.name,isLocal:e.isLocal,videoTrack:(r=e.videoTrack)==null?void 0:r.trackId,audioTrack:(o=e.audioTrack)==null?void 0:o.trackId,auxiliaryTracks:e.auxiliaryTracks.map(i=>i.trackId),customerUserId:e.customerUserId,customerDescription:e.metadata,metadata:e.metadata}}static convertTrack(e,t){let r={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(r,e),r}static enrichTrack(e,t){let r=t.getMediaTrackSettings();e.source==="screen"&&e.type==="video"&&(e.displaySurface=r.displaySurface),e.height=r.height,e.width=r.width,t instanceof _.HMSRemoteAudioTrack&&(e.volume=t.getVolume()||0),g.updateDeviceID(e,t),g.enrichVideoTrack(e,t),g.enrichPluginsDetails(e,t)}static updateDeviceID(e,t){var r;t instanceof _.HMSLocalVideoTrack||t instanceof _.HMSLocalAudioTrack?e.deviceID=t.settings.deviceId:e.deviceID=(r=t.getMediaTrackSettings())==null?void 0:r.deviceId}static enrichVideoTrack(e,t){t instanceof _.HMSRemoteVideoTrack&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,U(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichPluginsDetails(e,t){(t instanceof _.HMSLocalVideoTrack||t instanceof _.HMSLocalAudioTrack)&&(U(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(e){var i,a;let{recording:t,rtmp:r,hls:o}=g.convertRecordingStreamingState(e==null?void 0:e.recording,e==null?void 0:e.rtmp,e==null?void 0:e.hls);return{id:e.id,name:e.name,localPeer:(a=(i=e.localPeer)==null?void 0:i.peerId)!=null?a:"",hasWaitingRoom:e.hasWaitingRoom,shareableLink:e.shareableLink,recording:t,rtmp:r,hls:o,sessionId:e.sessionId,startedAt:e.startedAt,joinedAt:e.joinedAt,peerCount:e.peerCount}}static convertMessage(e){var t,r,o;return{sender:e.sender.peerId,senderName:e.sender.name,senderRole:(t=e.sender.role)==null?void 0:t.name,senderUserId:e.sender.customerUserId,recipientPeer:(r=e.recipientPeer)==null?void 0:r.peerId,recipientRoles:(o=e.recipientRoles)==null?void 0:o.map(i=>i.name),time:e.time,type:e.type,message:e.message}}static convertRoles(e){let t={};return e&&e.forEach(r=>{t[r.name]=r}),t}static convertRoleChangeRequest(e){var t;return{requestedBy:(t=e.requestedBy)==null?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){let t=this.getConvertedPlaylistType(e,p.audio),r=this.getConvertedPlaylistType(e,p.video);return{audio:t,video:r}}static convertPlaylistItem(e,t){let r=t.type,o=e.getCurrentSelection(r),i=e.isPlaying(r),a=t.url===(o==null?void 0:o.url);return F(N({},t),{type:t.type,selected:a,playing:a&&i})}static getConvertedPlaylistType(e,t){let r={},o=e.getCurrentSelection(t),i=e.getCurrentProgress(t),a=e.getVolume(t),c=e.getList(t),M=e.getCurrentIndex(t);return e.getList(t).forEach(R=>{r[R.id]=g.convertPlaylistItem(e,R)}),{list:r,selection:{id:o==null?void 0:o.id,hasPrevious:M>0,hasNext:M<c.length-1},progress:i,volume:a,currentTime:e.getCurrentTime(t),playbackRate:e.getPlaybackRate(t)}}static convertRecordingStreamingState(e,t,r){var o;return{recording:{browser:N({running:!1},e==null?void 0:e.browser),server:N({running:!1},e==null?void 0:e.server),hls:N({running:!1},e==null?void 0:e.hls)},rtmp:N({running:!1},t),hls:{variants:((o=r==null?void 0:r.variants)==null?void 0:o.map(i=>i))||[],running:!!(r==null?void 0:r.running),error:r==null?void 0:r.error}}}};var d=I(require("reselect"));function $(s,e,t=qt){let r,o;if(e)for(let i of e.auxiliaryTracks){let a=s[i];t(a)&&(o=Z(a)?a:o,r=ee(a)?a:r)}return{video:r,audio:o}}function Z(s){return s&&s.type==="audio"}function ee(s){return s&&s.type==="video"}function qt(s){return s&&s.source==="screen"}function Se(s){return s&&s.source==="audioplaylist"}function te(s){return s&&s.source==="videoplaylist"}function et(s){return Boolean(s==null?void 0:s.degraded)}function G(s,e){return e&&s.tracks[e]?s.tracks[e].enabled:!1}function tt(s,e){return e&&s.tracks[e]?s.tracks[e].displayEnabled:!1}var v=s=>s.room,jt=(0,d.createSelector)(v,s=>s.id),D=s=>s.peers,Re=s=>s.messages.byID,Ie=s=>s.messages.allIDs,y=s=>s.tracks,ve=s=>s.settings,$t=s=>s.devices,st=s=>s.speakers,rt=(0,d.createSelector)([v],s=>s&&s.isConnected),Wt=(0,d.createSelector)([rt,v],(s,e)=>s?e.peerCount||e.peers.length:Math.max(e.peerCount||e.peers.length-1,0)),W=(0,d.createSelector)([v,D],(s,e)=>s.peers.map(t=>e[t])),Ft=(0,d.createSelector)(y,s=>Object.values(s)),A=(0,d.createSelector)(v,D,(s,e)=>e[s.localPeer]),q=(0,d.createSelector)(v,s=>s.localPeer),C=(0,d.createSelector)(A,s=>s==null?void 0:s.audioTrack),L=(0,d.createSelector)(A,s=>s==null?void 0:s.videoTrack),Gt=(0,d.createSelector)(A,s=>s==null?void 0:s.auxiliaryTracks),De=(0,d.createSelector)([C,L,Gt],(s,e,t)=>{let r=[...t];return s&&r.unshift(s),e&&r.unshift(e),r}),Jt=(0,d.createSelector)(W,s=>s.filter(e=>!e.isLocal)),Yt=(0,d.createSelector)(D,st,(s,e)=>{let t=Object.entries(e).sort((r,o)=>{var c,M;let i=((c=r[1])==null?void 0:c.audioLevel)||0;return(((M=o[1])==null?void 0:M.audioLevel)||0)>i?1:-1});if(t.length>0&&t[0][1].audioLevel&&t[0][1].audioLevel>0){let r=t[0][1].peerID;if(r in s)return s[r]}return null}),Qt=s=>{let e=A(s);return G(s,e==null?void 0:e.audioTrack)},de=s=>{let e=A(s);return G(s,e==null?void 0:e.videoTrack)},be=s=>{let e=A(s);return tt(s,e==null?void 0:e.videoTrack)},ue=(0,d.createSelector)(A,y,(s,e)=>{let{video:t,audio:r}=$(e,s);return!!(t||r)}),ot=(0,d.createSelector)(D,y,(s,e)=>{let t;for(let r in s){let o=s[r],{video:i,audio:a}=$(e,o);if(i)return o;a&&!t&&(t=o)}return t}),Xt=(0,d.createSelector)(ot,s=>!!s),zt=(0,d.createSelector)(D,y,(s,e)=>{for(let t in s){let r=s[t],{audio:o,video:i}=$(e,r);if(!i&&!!o)return r}}),Zt=(0,d.createSelector)(D,y,(s,e)=>{let t=[],r=[];for(let o in s){let i=s[o],{video:a,audio:c}=$(e,i);a?t.push(i):c&&r.push(i)}return t.concat(r)}),es=(0,d.createSelector)(D,y,(s,e)=>{for(let t in e){let r=e[t];if(te(r)&&ee(r)&&r.peerId)return s[r.peerId]}}),ts=(0,d.createSelector)(D,y,(s,e)=>{for(let t in e){let r=e[t];if(Se(r)&&r.peerId)return s[r.peerId]}}),ss=(0,d.createSelector)(Ft,s=>s.filter(et)),Ee=(0,d.createSelector)(Ie,s=>s.length),rs=(0,d.createSelector)(Re,s=>Object.values(s).filter(e=>!e.read).length),se=(0,d.createSelector)(Ie,Re,(s,e)=>{let t=[];return s.forEach(r=>{t.push(e[r])}),t}),b=(0,d.createSelector)([v],s=>s&&s.roomState),os=(0,d.createSelector)(b,s=>s===H.Preview),Ae=(0,d.createSelector)(v,s=>s.roomState!==H.Disconnected),K=s=>s.roles,is=(0,d.createSelector)([K],s=>Object.keys(s)),re=(0,d.createSelector)([A,K],(s,e)=>(s==null?void 0:s.roleName)?e[s.roleName]:null),as=(0,d.createSelector)([re],s=>{var e;return((e=s==null?void 0:s.subscribeParams)==null?void 0:e.subscribeToRoles)?s.subscribeParams.subscribeToRoles.length>0:!1}),Ce=(0,d.createSelector)(re,s=>s==null?void 0:s.permissions),ns=(0,d.createSelector)(v,s=>s.recording),cs=(0,d.createSelector)(v,s=>s.rtmp),ls=(0,d.createSelector)(v,s=>s.hls),Ss=(0,d.createSelector)(v,s=>s.sessionId),ds=(0,d.createSelector)(v,s=>s.startedAt);var Le=I(require("reselect"));var it=(s=p.audio)=>e=>e.playlist[s].list,xe=(s=p.audio)=>e=>e.playlist[s].selection,at=(s=p.audio)=>e=>e.playlist[s].progress,nt=(s=p.audio)=>e=>e.playlist[s].currentTime,ct=(s=p.audio)=>e=>e.playlist[s].playbackRate,lt=(s=p.audio)=>e=>e.playlist[s].volume,St=(s=p.audio)=>(0,Le.createSelector)(it(s),e=>Object.values(e)),dt=(s=p.audio)=>(0,Le.createSelector)(it(s),xe(s),(e,t)=>{if(!!t.id)return e[t.id]}),Oe={selection:xe(p.audio),progress:at(p.audio),currentTime:nt(p.audio),playbackRate:ct(p.audio),volume:lt(p.audio),list:St(p.audio),selectedItem:dt(p.audio)},we={selection:xe(p.video),progress:at(p.video),currentTime:nt(p.video),playbackRate:ct(p.video),volume:lt(p.video),list:St(p.video),selectedItem:dt(p.video)};var k=I(require("reselect"));function u(s){return e=>t=>s(t,e)}var oe="HMS-Store:",m=class{static v(e,...t){this.log(n.HMSLogLevel.VERBOSE,e,...t)}static d(...e){this.log(n.HMSLogLevel.DEBUG,...e)}static i(...e){this.log(n.HMSLogLevel.INFO,...e)}static w(...e){this.log(n.HMSLogLevel.WARN,...e)}static e(...e){this.log(n.HMSLogLevel.ERROR,...e)}static time(e){this.log(n.HMSLogLevel.TIME,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(n.HMSLogLevel.TIMEEND,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case n.HMSLogLevel.VERBOSE:{console.log(oe,...t);break}case n.HMSLogLevel.DEBUG:{console.debug(oe,...t);break}case n.HMSLogLevel.INFO:{console.info(oe,...t);break}case n.HMSLogLevel.WARN:{console.warn(oe,...t);break}case n.HMSLogLevel.ERROR:{console.error(oe,...t);break}case n.HMSLogLevel.TIME:{performance.mark(t[1]);break}case n.HMSLogLevel.TIMEEND:{let r=t[0],o=t[1];try{let i=performance.measure(o,o);this.log(n.HMSLogLevel.DEBUG,r,o,i==null?void 0:i.duration),performance.clearMarks(o),performance.clearMeasures(o)}catch(i){this.log(n.HMSLogLevel.DEBUG,r,o,i)}break}}}};m.level=n.HMSLogLevel.VERBOSE;var Ne=(s,e)=>e,us=(s,e)=>e,ut=(s,e)=>e,E=(0,k.createSelector)([D,Ne],(s,e)=>e?s[e]:null),Ue=(0,k.createSelector)([y,us],(s,e)=>e?s[e]:null),O=u(E),Ms=u((0,k.createSelector)(E,s=>s==null?void 0:s.name)),ie=u(Ue),Mt=u((s,e)=>{let t=E(s,e);if(t&&t.videoTrack&&t.videoTrack!=="")return s.tracks[t.videoTrack]}),pt=u((s,e)=>{let t=E(s,e);if(t&&t.audioTrack&&t.audioTrack!=="")return s.tracks[t.audioTrack]}),ps=Mt,ms=u((s,e)=>{let t=E(s,e);return(t==null?void 0:t.auxiliaryTracks.map(r=>s.tracks[r]))||[]}),mt=(s,e)=>e?s.speakers[e]:null,hs=u((0,k.createSelector)(mt,s=>(s==null?void 0:s.audioLevel)||0)),gs=(s,e)=>{let t=pt(e)(s);return mt(s,t==null?void 0:t.id)},Ts=u((0,k.createSelector)(gs,s=>(s==null?void 0:s.audioLevel)||0)),Hs=u((s,e)=>{let t=E(s,e);if(t){let r=t==null?void 0:t.auxiliaryTracks.find(o=>Z(s.tracks[o]));return r?s.tracks[r]:void 0}}),ys=u((0,k.createSelector)(y,E,(s,e)=>{let t=e==null?void 0:e.auxiliaryTracks.find(r=>{let o=s[r];return te(o)&&ee(o)});return t?s[t]:void 0})),fs=u((0,k.createSelector)(y,E,(s,e)=>{let t=e==null?void 0:e.auxiliaryTracks.find(r=>{let o=s[r];return te(o)&&Z(o)});return t?s[t]:void 0})),ks=u((0,k.createSelector)(y,E,(s,e)=>{let t=e==null?void 0:e.auxiliaryTracks.find(r=>{let o=s[r];return Se(o)&&Z(o)});return t?s[t]:void 0})),_e=u((0,k.createSelector)(y,E,(s,e)=>$(s,e))),Ps=s=>(0,k.createSelector)(_e(s),e=>e.video),Ke=s=>(0,k.createSelector)(_e(s),e=>e.audio),Rs=u((s,e)=>{let t=E(s,e);return G(s,t==null?void 0:t.audioTrack)}),Is=u((s,e)=>{let t=E(s,e);return G(s,t==null?void 0:t.videoTrack)}),Ve=u((s,e)=>{if(e&&s.tracks[e])return s.tracks[e].volume===0}),vs=u((s,e)=>{let t=E(s,e);return Ve(t==null?void 0:t.audioTrack)(s)}),Ds=u((s,e)=>{let t=Ke(e)(s);return Ve(t==null?void 0:t.id)(s)}),Be=u((s,e)=>{let t=Ue(s,e);if(t){if(t.type!=="audio"){m.w("Please pass audio track here");return}return t.volume}}),bs=u((s,e)=>{let t=E(s,e);return Be(t==null?void 0:t.audioTrack)(s)}),Es=u((s,e)=>{let t=Ke(e)(s);return Be(t==null?void 0:t.id)(s)}),As=u((s,e)=>{let t=Ue(s,e);if(t){if(t.type!=="video"){m.w("Please pass video track here");return}return t.layer}}),ht=(0,k.createSelector)([se,q,Ne],(s,e,t)=>{if(!!t)return s.filter(r=>{var o;return!r.recipientPeer&&!((o=r.recipientRoles)==null?void 0:o.length)||![e,t].includes(r.sender)?!1:[e,t].includes(r.recipientPeer)})}),gt=(0,k.createSelector)([se,ut],(s,e)=>{if(!!e)return s.filter(t=>{var r,o;return((r=t.recipientRoles)==null?void 0:r.length)?(o=t.recipientRoles)==null?void 0:o.includes(e):!1})}),Tt=(0,k.createSelector)(se,s=>s.filter(e=>{var t;return!e.recipientPeer&&!((t=e.recipientRoles)==null?void 0:t.length)})),Cs=(0,k.createSelector)([gt,ut],s=>s?s.filter(e=>!e.read).length:0),Ls=(0,k.createSelector)([ht,Ne],s=>s?s.filter(e=>!e.read).length:0),xs=(0,k.createSelector)(Tt,s=>s.filter(e=>!e.read).length),Os=u(ht),ws=u(gt),Ns=u(Cs),Us=u(Ls),_s=s=>(0,k.createSelector)([W],e=>e.filter(t=>t.roleName===s)),Ks=s=>(0,k.createSelector)(O(s),e=>{try{return(e==null?void 0:e.metadata)&&e.metadata!==""?JSON.parse(e.metadata):{}}catch(t){return console.error("cannot parse peer metadata",t),{}}});var Me=I(require("reselect")),Vs=(0,Me.createSelector)([D,y],(s,e)=>Object.values(s).map(r=>{var o;return{peer:r,isAudioEnabled:r.audioTrack?(o=e[r.audioTrack])==null?void 0:o.enabled:!1}})),Bs=s=>s.roleChangeRequests[0]||null,qs=(0,Me.createSelector)([Bs,D,K],(s,e,t)=>s?{requestedBy:s.requestedBy?e[s.requestedBy]:void 0,role:t[s.roleName],token:s.token}:null),js=(0,Me.createSelector)([re],s=>{var o;let e=!1,t=!1,r=!1;return((o=s==null?void 0:s.publishParams)==null?void 0:o.allowed)&&(e=s.publishParams.allowed.includes("video"),t=s.publishParams.allowed.includes("audio"),r=s.publishParams.allowed.includes("screen")),{video:e,audio:t,screen:r}});var V=I(require("reselect"));var $s=s=>(0,V.createSelector)([K],e=>e[s]),Ws=(0,V.createSelector)([L,y],(s,e)=>{let t=null;return s&&(t=e[s]),(t==null?void 0:t.plugins)||[]}),Fs=(0,V.createSelector)([C,y],(s,e)=>{let t=null;return s&&(t=e[s]),(t==null?void 0:t.plugins)||[]}),Gs=s=>(0,V.createSelector)([Ws],e=>e.includes(s)),Js=s=>(0,V.createSelector)([Fs],e=>e.includes(s)),Ys=s=>(0,V.createSelector)(W,e=>e.find(s)),Qs=s=>(0,V.createSelector)(W,e=>e.filter(s)),Xs=s=>(0,V.createSelector)(v,e=>e.joinedAt&&Date.now()-e.joinedAt.getTime()<=s);var ae=I(require("@100mslive/hms-video"));var pe=I(require("@100mslive/hms-video"));function Ht(s){return s instanceof pe.HMSRemoteAudioTrack||s instanceof pe.HMSRemoteVideoTrack}var me=class{constructor(e,t,r,o){this.playlistManager=e;this.syncPlaylistState=r;this.store=o;this.type=t}play(e){return l(this,null,function*(){if(!e){m.w("Please pass id to play");return}yield this.playlistManager.setEnabled(!0,{id:e,type:this.type})})}pause(){return l(this,null,function*(){let e=this.type===p.audio?Oe:we,t=this.store.getState(e.selection);if(!t.id){m.w("No item is currently playing to pause");return}yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type})})}playNext(){return l(this,null,function*(){yield this.playlistManager.playNext(this.type)})}playPrevious(){return l(this,null,function*(){yield this.playlistManager.playPrevious(this.type)})}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return l(this,null,function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)})}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}};var yt={[n.HMSPeerUpdate.PEER_JOINED]:h.PEER_JOINED,[n.HMSPeerUpdate.PEER_LEFT]:h.PEER_LEFT,[n.HMSPeerUpdate.ROLE_UPDATED]:h.ROLE_UPDATED,[n.HMSPeerUpdate.AUDIO_TOGGLED]:"PEER_AUDIO_UPDATED",[n.HMSPeerUpdate.VIDEO_TOGGLED]:"PEER_VIDEO_UPDATED",[n.HMSPeerUpdate.NAME_UPDATED]:h.NAME_UPDATED,[n.HMSPeerUpdate.METADATA_UPDATED]:h.METADATA_UPDATED},ft={[n.HMSTrackUpdate.TRACK_ADDED]:h.TRACK_ADDED,[n.HMSTrackUpdate.TRACK_REMOVED]:h.TRACK_REMOVED,[n.HMSTrackUpdate.TRACK_MUTED]:h.TRACK_MUTED,[n.HMSTrackUpdate.TRACK_UNMUTED]:h.TRACK_UNMUTED,[n.HMSTrackUpdate.TRACK_DEGRADED]:h.TRACK_DEGRADED,[n.HMSTrackUpdate.TRACK_RESTORED]:h.TRACK_RESTORED},kt={[n.HMSPeerUpdate.PEER_JOINED]:"peerJoined",[n.HMSPeerUpdate.PEER_LEFT]:"peerLeft",[n.HMSPeerUpdate.NAME_UPDATED]:"peerNameUpdated",[n.HMSPeerUpdate.METADATA_UPDATED]:"peerMetadataUpdated"};var qe=class{constructor(e,t,r){this.hmsSDKTracks={};this.hmsSDKPeers={};this.isRoomJoinCalled=!1;this.setProgress=({type:e,progress:t})=>{this.setState(r=>{r.playlist[e].progress=t,r.playlist[e].currentTime=this.sdk.getPlaylistManager().getCurrentTime(e)},"playlistProgress")};this.syncPlaylistState=e=>{this.setState(t=>{Object.assign(t.playlist,g.convertPlaylist(this.sdk.getPlaylistManager()))},e)};this.sendPeerUpdateNotification=(e,t)=>{let r=this.store.getState(O(t.peerId)),o="peerUpdate";o=kt[e],this.syncRoomState(o),r||(r=this.store.getState(O(t.peerId))),this.hmsNotifications.sendPeerUpdate(e,r)};this.setState=(e,t)=>this.store.namedSetState(e,t);this.store=e,this.sdk=t,this.hmsNotifications=r}unblockAudio(){return l(this,null,function*(){yield this.sdk.getAudioOutput().unblockAutoplay()})}setVolume(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}setAudioOutputDevice(e){this.sdk.getAudioOutput().setDevice(e)&&this.setState(r=>{r.settings.audioOutputDeviceId=e},"setAudioOutputDevice")}setPreferredLayer(e,t){let r=this.hmsSDKTracks[e];r?r instanceof ae.HMSRemoteVideoTrack?(r.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):m.w(`track ${e} is not an video track`):this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}preview(e){return l(this,null,function*(){if(this.isRoomJoinCalled){this.logPossibleInconsistency("attempting to call preview after join was called");return}let t=this.store.getState(b);if(t===H.Preview||t===H.Connecting){this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting");return}try{this.setState(r=>{r.room.roomState=H.Connecting},"connecting"),yield this.sdkPreviewWithListeners(e)}catch(r){throw m.e("Cannot show preview. Failed to connect to room - ",r),r}})}join(e){if(this.isRoomJoinCalled){this.logPossibleInconsistency("room join is called again");return}try{this.sdkJoinWithListeners(e),this.isRoomJoinCalled=!0,this.setState(t=>{t.room.roomState=H.Connecting},"join")}catch(t){throw this.isRoomJoinCalled=!1,m.e("Failed to connect to room - ",t),t}}leave(){return l(this,null,function*(){if(!this.store.getState(Ae)){this.logPossibleInconsistency("room leave is called when no room is connected");return}let t=this.store.getState(b);return this.setState(r=>{r.room.roomState=H.Disconnecting},"leaving"),this.sdk.leave().then(()=>{this.resetState("leave"),m.i("left room")}).catch(r=>{m.e("error in leaving room - ",r),this.setState(o=>{o.room.roomState=t},"revertLeave")})})}setScreenShareEnabled(e,t){return l(this,null,function*(){e?yield this.startScreenShare(t):yield this.stopScreenShare()})}addTrack(e,t="regular"){return l(this,null,function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")})}removeTrack(e){return l(this,null,function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")})}setLocalAudioEnabled(e){return l(this,null,function*(){let t=this.store.getState(C);t&&(yield this.setEnabledTrack(t,e))})}setLocalVideoEnabled(e){return l(this,null,function*(){let t=this.store.getState(L);t&&(yield this.setEnabledTrack(t,e))})}setEnabledTrack(e,t){return l(this,null,function*(){var i;if(((i=this.store.getState().tracks[e])==null?void 0:i.enabled)===t){this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);return}this.setState(a=>{a.tracks[e]?a.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(a){throw this.setState(c=>{c.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(g.convertException(a)),a}let o=t?n.HMSTrackUpdate.TRACK_UNMUTED:n.HMSTrackUpdate.TRACK_MUTED;this.hmsNotifications.sendTrackUpdate(o,e)})}setAudioSettings(e){return l(this,null,function*(){let t=this.store.getState(C);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))})}setVideoSettings(e){return l(this,null,function*(){let t=this.store.getState(L);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))})}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return l(this,null,function*(){let r=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore(r,{message:e,type:t})})}sendGroupMessage(e,t,r){return l(this,null,function*(){let o=this.store.getState(K),i=t.map(c=>o[c]),a=yield this.sdk.sendGroupMessage(e,i,r);this.updateMessageInStore(a,{message:e,recipientRoles:t,type:r})})}sendDirectMessage(e,t,r){return l(this,null,function*(){let o=this.hmsSDKPeers[t],i=yield this.sdk.sendDirectMessage(e,o,r);this.updateMessageInStore(i,{message:e,recipientPeer:o.peerId,type:r})})}updateMessageInStore(e,t){if(!e)throw m.w("sendMessage","Failed to send message",t),Error(`sendMessage Failed - ${JSON.stringify(t)}`);let r=g.convertMessage(e);return r.read=!0,r.senderName="You",this.onHMSMessage(r),r}setMessageRead(e,t){this.setState(r=>{t?r.messages.byID[t]?r.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):r.messages.allIDs.forEach(o=>{r.messages.byID[o].read=e})},"setMessageRead")}attachVideo(e,t){return l(this,null,function*(){if(this.localAndVideoUnmuting(e))return new Promise(r=>{let o=this.store.subscribe(i=>l(this,null,function*(){i&&(yield this.attachVideoInternal(e,t),o(),r())}),de)});yield this.attachVideoInternal(e,t)})}detachVideo(e,t){return l(this,null,function*(){let r=this.hmsSDKTracks[e];r&&r.type==="video"?(yield r.removeSink(t),this.updateVideoLayer(e,"detachVideo")):this.logPossibleInconsistency("no video track found to remove sink")})}addPluginToVideoTrack(e,t){return l(this,null,function*(){return this.addRemoveVideoPlugin(e,"add",t)})}addPluginToAudioTrack(e){return l(this,null,function*(){return this.addRemoveAudioPlugin(e,"add")})}removePluginFromVideoTrack(e){return l(this,null,function*(){return this.addRemoveVideoPlugin(e,"remove")})}removePluginFromAudioTrack(e){return l(this,null,function*(){return this.addRemoveAudioPlugin(e,"remove")})}changeRole(e,t,r=!1){return l(this,null,function*(){let o=this.hmsSDKPeers[e];if(!o){this.logPossibleInconsistency(`Unknown peer ID given ${e} for changerole`);return}yield this.sdk.changeRole(o,t,r)})}acceptChangeRole(e){return l(this,null,function*(){let t=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0;t||m.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let r={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(r),this.removeRoleChangeRequest(e)})}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return l(this,null,function*(){let r=this.store.getState(Ce);if(!(r==null?void 0:r.endRoom)){m.w("You are not allowed to perform this action - endRoom");return}let o=this.store.getState(b);this.setState(i=>{i.room.roomState=H.Disconnecting},"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(i){m.e("error in ending room - ",i),this.setState(a=>{a.room.roomState=o},"revertEndRoom")}})}removePeer(e,t){return l(this,null,function*(){let r=this.hmsSDKPeers[e];if(r&&!r.isLocal)yield this.sdk.removePeer(r,t);else{this.logPossibleInconsistency(`No remote peer found for peerID - ${e}`);return}})}startRTMPOrRecording(e){return l(this,null,function*(){yield this.sdk.startRTMPOrRecording(e)})}stopRTMPAndRecording(){return l(this,null,function*(){yield this.sdk.stopRTMPAndRecording()})}startHLSStreaming(e){return l(this,null,function*(){yield this.sdk.startHLSStreaming(e)})}stopHLSStreaming(e){return l(this,null,function*(){yield this.sdk.stopHLSStreaming(e)})}changeName(e){return l(this,null,function*(){yield this.sdk.changeName(e)})}changeMetadata(e){return l(this,null,function*(){typeof e!="string"&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)})}setRemoteTrackEnabled(e,t){return l(this,null,function*(){if(typeof e=="string"){let r=this.hmsSDKTracks[e];r&&Ht(r)?yield this.sdk.changeTrackState(r,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach(r=>this.setRemoteTrackEnabled(r,t))})}setRemoteTracksEnabled(e){return l(this,null,function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let r=this.store.getState(K);t.roles=e.roles.map(o=>r[o])}yield this.sdk.changeMultiTrackState(t)})}setLogLevel(e){m.level=e,this.sdk.setLogLevel(e)}resetState(e="resetState"){this.setState(t=>{Object.assign(t,X())},e),this.isRoomJoinCalled=!1,this.hmsSDKTracks={},m.cleanUp()}sdkJoinWithListeners(e){this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})}onRemovedFromRoom(e){var o;let t=this.store.getState(O((o=e.requestedBy)==null?void 0:o.peerId));this.hmsNotifications.sendLeaveRoom(F(N({},e),{requestedBy:t||void 0}));let r=e.roomEnded||!t?"roomEnded":"removedFromRoom";m.i(`resetting state after peer removed ${r}`,e),this.resetState(r)}onDeviceChange(e){let t=e.devices;if(!t)return;let r=this.store.getState(A);if(this.setState(o=>{U(o.devices.audioInput,t.audioInput)||(o.devices.audioInput=t.audioInput),U(o.devices.videoInput,t.videoInput)||(o.devices.videoInput=t.videoInput),U(o.devices.audioOutput,t.audioOutput)||(o.devices.audioOutput=t.audioOutput),this.hmsSDKPeers[r==null?void 0:r.id]&&Object.assign(o.settings,this.getMediaSettings(this.hmsSDKPeers[r==null?void 0:r.id]))},"deviceChange"),e.selection){let o=g.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(o)}}sdkPreviewWithListeners(e){return l(this,null,function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})})}startScreenShare(e){return l(this,null,function*(){this.store.getState(ue)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare(()=>this.syncRoomState("screenshareStopped"),e),this.syncRoomState("startScreenShare"))})}stopScreenShare(){return l(this,null,function*(){this.store.getState(ue)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")})}attachVideoInternal(e,t){return l(this,null,function*(){let r=this.hmsSDKTracks[e];r&&r.type==="video"?(yield r.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink")})}syncRoomState(e){m.time(`store-sync-${e}`);let t={},r=[],o={},i={},a={},c=this.sdk.getPeers();for(let f of c){let w=g.convertPeer(f);t[w.id]=w,r.push(w.id),this.hmsSDKPeers[w.id]=f;let Y=[f.audioTrack,f.videoTrack,...f.auxiliaryTracks];for(let le of Y){if(!le)continue;let Ge=g.convertTrack(le);o[Ge.id]=Ge,i[le.trackId]=le}w.isLocal&&Object.assign(a,this.getMediaSettings(f))}let M=this.sdk.getRecordingState(),R=this.sdk.getRTMPState(),j=this.sdk.getHLSState();this.setState(f=>{f.room.peers=r;let w=f.peers,Y=f.tracks;ze(w,t),Ze(Y,o),Object.assign(f.settings,a),this.hmsSDKTracks=i,Object.assign(f.roles,g.convertRoles(this.sdk.getRoles())),Object.assign(f.playlist,g.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(f.room,g.convertRecordingStreamingState(M,R,j))},e),m.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState(t=>{Object.assign(t.room,g.convertRoom(e)),t.room.roomState=H.Preview},"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new me(t,p.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new me(t,p.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(r=>{Object.assign(r.room,g.convertRoom(e)),r.room.isConnected=!0,r.room.roomState=H.Connected},"joined"),t.onProgress(this.setProgress),t.onNewTrackStart(r=>{this.syncPlaylistState(`${r.type}PlaylistUpdate`)}),t.onPlaylistEnded(r=>{this.syncPlaylistState(`${r}PlaylistEnded`)}),t.onCurrentTrackEnded(r=>{this.hmsNotifications.sendPlaylistTrackEnded(g.convertPlaylistItem(t,r)),this.syncPlaylistState(`${r.type}PlaylistItemEnded`)})}onRoomUpdate(e,t){this.setState(r=>{Object.assign(r.room,g.convertRoom(t))},"RoomUpdate")}onPeerUpdate(e,t){if(![n.HMSPeerUpdate.BECAME_DOMINANT_SPEAKER,n.HMSPeerUpdate.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");let r=[];for(let o of t){let i=this.store.getState(O(o.peerId));i&&r.push(i)}this.hmsNotifications.sendPeerList(r);return}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,r){if(e===n.HMSTrackUpdate.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,r);else{let o=e===n.HMSTrackUpdate.TRACK_ADDED?"trackAdded":"trackUpdate";this.syncRoomState(o),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=g.convertMessage(e);t.read=!1,this.onHMSMessage(t),this.hmsNotifications.sendMessageReceived(t)}onHMSMessage(e){this.setState(t=>{e.id=String(this.store.getState(Ee)+1),t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)},"newMessage")}onAudioLevelUpdate(e){this.setState(t=>{let r={};e.forEach(i=>{if(!i.track||!i.peer)return;let a=i.track.trackId;r[a]=i.audioLevel,t.speakers[a]||(t.speakers[a]={audioLevel:i.audioLevel,peerID:i.peer.peerId,trackID:a})});let o=Object.entries(t.speakers);for(let[i,a]of o)a.audioLevel=r[i]||0,a.audioLevel===0&&delete t.speakers[i]},"audioLevel")}onChangeTrackStateRequest(e){var i;let t=this.store.getState(O((i=e.requestedBy)==null?void 0:i.peerId)),r=this.getStoreLocalTrackIDfromSDKTrack(e.track),o=this.store.getState(ie(r));if(!o)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:t||void 0,track:o,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var i;let t=this.store.getState(O((i=e.requestedBy)==null?void 0:i.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let r=[],o=this.store.getState(y);for(let a of e.tracks){let c=this.getStoreLocalTrackIDfromSDKTrack(a);c&&o[c]&&r.push(o[c])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:t||void 0,tracks:r,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(e=>{e.room.roomState=H.Connected},"reconnected")}onReconnecting(e){let t=g.convertException(e);m.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(r=>{r.room.roomState=H.Reconnecting,r.errors.push(t)},"reconnecting")}onError(e){let t=g.convertException(e);t.isTerminal?(this.leave().then(()=>m.e("error from SDK, left room.")),this.setState(r=>{r.room.roomState=H.Failed,r.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(o=>{o.errors.push(t)},"error"),this.hmsNotifications.sendError(t),m.e("received error from sdk",t)}updateVideoLayer(e,t){let r=this.hmsSDKTracks[e];r&&r instanceof ae.HMSRemoteVideoTrack&&this.setState(o=>{o.tracks[e].layer=r.getSimulcastLayer()},t)}handleTrackRemove(e,t){this.setState(r=>{let o=r.peers[t.peerId],i=r.tracks,a=e.trackId;if(this.isSameStoreSDKTrack(a,o==null?void 0:o.audioTrack))o==null||delete o.audioTrack;else if(this.isSameStoreSDKTrack(a,o==null?void 0:o.videoTrack))o==null||delete o.videoTrack;else{let c=o==null?void 0:o.auxiliaryTracks.indexOf(a);c>-1&&this.isSameStoreSDKTrack(a,o==null?void 0:o.auxiliaryTracks[c])&&(o==null||o.auxiliaryTracks.splice(c,1))}delete i[a],delete this.hmsSDKTracks[a]},"trackRemoved")}setEnabledSDKTrack(e,t){return l(this,null,function*(){let r=this.hmsSDKTracks[e];r?yield r.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)})}setSDKLocalVideoTrackSettings(e,t){return l(this,null,function*(){let r=this.hmsSDKTracks[e];r?yield r.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}setSDKLocalAudioTrackSettings(e,t){return l(this,null,function*(){let r=this.hmsSDKTracks[e];r?yield r.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)})}getMediaSettings(e){var i;let t=this.store.getState(ve),r=e.audioTrack,o=e.videoTrack;return{audioInputDeviceId:(r==null?void 0:r.settings.deviceId)||t.audioInputDeviceId,videoInputDeviceId:(o==null?void 0:o.settings.deviceId)||t.videoInputDeviceId,audioOutputDeviceId:(i=this.sdk.getAudioOutput().getDevice())==null?void 0:i.deviceId}}setTrackVolume(e,t){let r=this.hmsSDKTracks[t];r?r instanceof ae.HMSAudioTrack?(r.setVolume(e),this.setState(o=>{let i=o.tracks[t];i&&(i.volume=e)},"trackVolume")):m.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}localAndVideoUnmuting(e){if(this.store.getState(A).videoTrack!==e)return!1;let r=this.store.getState(be),o=this.store.getState(de);return r&&!o}logPossibleInconsistency(e){m.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,r){return l(this,null,function*(){if(!e){m.w("Invalid plugin received in store");return}let o=this.store.getState(L);if(o){let i=this.hmsSDKTracks[o];i?(t==="add"?yield i.addPlugin(e,r):t==="remove"&&(yield i.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${o} not present, unable to remove plugin`)}})}addRemoveAudioPlugin(e,t){return l(this,null,function*(){if(!e){m.w("Invalid plugin received in store");return}let r=this.store.getState(C);if(r){let o=this.hmsSDKTracks[r];o?(t==="add"?yield o.addPlugin(e):t==="remove"&&(yield o.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${r} not present, unable to remove plugin`)}})}isSameStoreSDKTrack(e,t){var r;return t?((r=this.hmsSDKTracks[t])==null?void 0:r.trackId)===e:!1}onRoleChangeRequest(e){this.setState(t=>{t.roleChangeRequests.length===0&&t.roleChangeRequests.push(g.convertRoleChangeRequest(e))},"roleChangeRequest")}removeRoleChangeRequest(e){this.setState(t=>{let r=t.roleChangeRequests.findIndex(o=>o.token===e.token);r!==-1&&t.roleChangeRequests.splice(r,1)},"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(De).find(r=>this.hmsSDKTracks[r].trackId===e.trackId)}};var Pt=I(require("eventemitter2"));var je="hmsNotification",$e=class{constructor(e){this.id=0;this.onNotification=e=>(this.eventEmitter.addListener(je,e),()=>{this.eventEmitter.removeListener(je,e)});this.store=e,this.eventEmitter=new Pt.EventEmitter2}sendPlaylistTrackEnded(e){let t=this.createNotification(h.PLAYLIST_TRACK_ENDED,e,P.INFO);this.emitEvent(t)}sendDeviceChange(e){var r;let t=this.createNotification(h.DEVICE_CHANGE_UPDATE,e,e.error?P.ERROR:P.INFO,`Selected ${e.type} device - ${(r=e.selection)==null?void 0:r.label}`);this.emitEvent(t)}sendLeaveRoom(e){var o;let t=(o=e.requestedBy)==null?void 0:o.name,r=this.createNotification(e.roomEnded||!t?h.ROOM_ENDED:h.REMOVED_FROM_ROOM,e,P.INFO,`${e.roomEnded?"Room ended":"Removed from room"} ${t?`by ${t}`:""}`);this.emitEvent(r)}sendPeerList(e){let t=this.createNotification(h.PEER_LIST,e,P.INFO);this.emitEvent(t)}sendPeerUpdate(e,t){let r=this.store.getState(O(t==null?void 0:t.id))||t,o=yt[e];if(o){let i=this.createNotification(o,r,P.INFO);this.emitEvent(i)}}sendTrackUpdate(e,t){let r=this.store.getState(ie(t)),o=ft[e];if(o){let i=this.createNotification(o,r,P.INFO);this.emitEvent(i)}}sendMessageReceived(e){let t=this.createNotification(h.NEW_MESSAGE,e,P.INFO);this.emitEvent(t)}sendError(e){let t=this.createNotification(h.ERROR,e,P.ERROR);this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification(h.RECONNECTING,e,P.ERROR);this.emitEvent(t)}sendReconnected(){let e=this.createNotification(h.RECONNECTED,null,P.INFO);this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification(h.CHANGE_TRACK_STATE_REQUEST,e,P.INFO);this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification(h.CHANGE_MULTI_TRACK_STATE_REQUEST,e,P.INFO);this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(je,e)}createNotification(e,t,r,o=""){return this.id++,{id:this.id,type:e,message:o,data:t,severity:r}}};var Rt=I(require("@100mslive/hms-video")),he=s=>Rt.isBrowser?`${s} ${document.title}`:s;var It=(s,e,t)=>{let r;t.getState(b)===H.Connected&&(r=vt(s,e,t)),t.subscribe(o=>{[H.Connected,H.Reconnecting].includes(o)?r||(r=vt(s,e,t)):r&&(er(e),r())},b)},vt=(s,e,t)=>{var i;let r=zs(t,e),o=(i=s.getWebrtcInternals())==null?void 0:i.onStatsChange(a=>Zs(e,a,t));return()=>{r(),o&&o()}},zs=(s,e)=>{let t,r,o;return s.getState(q)?e.namedSetState(i=>{i.localPeer.id=s.getState(q)},"localpeer-id"):t=s.subscribe(i=>{i&&e.namedSetState(a=>{a.localPeer.id=i},"localpeer-id")},q),s.getState(L)?e.namedSetState(i=>{i.localPeer.videoTrack=s.getState(L)},"localpeer-videotrack-id"):r=s.subscribe(i=>{i&&e.namedSetState(a=>{a.localPeer.videoTrack=i},"localpeer-videotrack-id")},L),s.getState(C)?e.namedSetState(i=>{i.localPeer.videoTrack=s.getState(C)},"localpeer-audiotrack-id"):o=s.subscribe(i=>{i&&e.namedSetState(a=>{a.localPeer.videoTrack=i},"localpeer-audiotrack-id")},C),()=>{t==null||t(),r==null||r(),o==null||o()}},Zs=(s,e,t)=>{let r=t.getState(y);s.namedSetState(o=>{let i={},a=Object.keys(r);for(let R of a){let j=e.getTrackStats(R);j&&(i[R]=j)}He(o.trackStats,i);let M={[t.getState(q)]:e.getLocalPeerStats()};He(o.peerStats,M)},"webrtc-stats")},er=(s,e="resetState")=>{s.namedSetState(t=>{Object.assign(t,z())},e)};var ne=class{constructor(e,t){this.hmsStore=e;this.sdk=t;this.store=x.createNewHMSStore(he("HMSStatsStore"),z),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise(r=>{var o,i;this.hmsStore.getState(b)==="Connected"?r((i=(o=this.sdk)==null?void 0:o.getWebrtcInternals())==null?void 0:i.getPublishPeerConnection()):this.hmsStore.subscribe(a=>{var c,M;a==="Connected"&&r((M=(c=this.sdk)==null?void 0:c.getWebrtcInternals())==null?void 0:M.getPublishPeerConnection())},b)}),this.getSubscribePeerConnection=()=>new Promise(r=>{var o,i;this.hmsStore.getState(b)==="Connected"?r((i=(o=this.sdk)==null?void 0:o.getWebrtcInternals())==null?void 0:i.getSubscribePeerConnection()):this.hmsStore.subscribe(a=>{var c,M;a==="Connected"&&r((M=(c=this.sdk)==null?void 0:c.getWebrtcInternals())==null?void 0:M.getSubscribePeerConnection())},b)}),!!this.sdk&&It(this.sdk,this.store,this.hmsStore)}};var T=I(require("reselect"));var tr=s=>s.localPeer.id,sr=s=>s.localPeer.audioTrack,rr=s=>s.localPeer.videoTrack,or=(s,e)=>e,ir=(s,e)=>e,We=s=>s.trackStats,Dt=s=>s.peerStats,B=(0,T.createSelector)([Dt,tr],(s,e)=>s[e]),ar=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.packetsLost}),nr=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.jitter}),cr=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.publish)==null?void 0:e.bitrate}),lr=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.bitrate}),Sr=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.publish)==null?void 0:e.availableOutgoingBitrate}),dr=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.availableIncomingBitrate}),ur=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.publish)==null?void 0:e.bytesSent}),Mr=(0,T.createSelector)(B,s=>{var e;return(e=s==null?void 0:s.subscribe)==null?void 0:e.bytesReceived}),pr=(0,T.createSelector)([Dt,or],(s,e)=>e?s[e]:void 0),J=(0,T.createSelector)([We,ir],(s,e)=>e?s[e]:void 0),mr=u(pr),hr=u(J),gr=u((0,T.createSelector)(J,s=>s==null?void 0:s.bitrate)),Tr=u((0,T.createSelector)(J,s=>s==null?void 0:s.bytesReceived)),Hr=u((0,T.createSelector)(J,s=>s==null?void 0:s.framesPerSecond)),yr=u((0,T.createSelector)(J,s=>s==null?void 0:s.jitter)),fr=u((0,T.createSelector)(J,s=>s==null?void 0:s.packetsLost)),Fe=(0,T.createSelector)([We,sr],(s,e)=>e?s[e]:void 0),ce=(0,T.createSelector)([We,rr],(s,e)=>e?s[e]:void 0),kr=(0,T.createSelector)(Fe,s=>s==null?void 0:s.bitrate),Pr=(0,T.createSelector)(ce,s=>s==null?void 0:s.bitrate),Rr=(0,T.createSelector)(Fe,s=>s==null?void 0:s.bytesSent),Ir=(0,T.createSelector)(ce,s=>s==null?void 0:s.bytesSent),vr=(0,T.createSelector)(ce,s=>s==null?void 0:s.framesPerSecond),Dr=(0,T.createSelector)(ce,s=>s==null?void 0:s.qualityLimitationReason),bt={localPeerStats:B,packetsLost:ar,jitter:nr,publishBitrate:cr,subscribeBitrate:lr,availablePublishBitrate:Sr,availableSubscribeBitrate:dr,totalBytesSent:ur,totalBytesReceived:Mr,peerStatsByID:mr,trackStatsByID:hr,bitrateByTrackID:gr,bytesReceivedByTrackID:Tr,framerateByTrackID:Hr,jitterByTrackID:yr,packetsLostByTrackID:fr,localAudioTrackStats:Fe,localVideoTrackStats:ce,localAudioTrackBitrate:kr,localVideoTrackBitrate:Pr,localAudioTrackBytesSent:Rr,localVideoTrackBytesSent:Ir,localVideoTrackFramerate:vr,localVideoTrackQualityLimitationReason:Dr};var x=class{constructor(e,t,r){this.getStats=()=>(this.stats||(this.stats=new ne(this.store,this.sdk)),this.stats);e?this.store=e:this.store=x.createNewHMSStore(he("HMSStore"),X),r?this.notifications=r:this.notifications=new $e(this.store),t?this.actions=t:(this.sdk=new ge.HMSSdk,this.actions=new qe(this.store,this.sdk,this.notifications)),this.initialTriggerOnSubscribe=!1,ge.isBrowser&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(x.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(e,t){let r=(0,At.default)(()=>t()),o=r.setState;r.setState=c=>{let M=typeof c=="function"?(0,Et.default)(c):c;o(M)};let i=r.getState;r.getState=c=>{if(c){let M=c.name||"byIDSelector";window.selectorsCount||(window.selectorsCount={}),window.selectorsCount[M]=(window.selectorsCount[M]||0)+1;let R=performance.now(),j=c(i()),f=performance.now()-R;return f>1&&(window.expensiveSelectors=window.expensiveSelectors||new Map,window.expensiveSelectors.set(M,f)),j}return i()},x.compareWithShallowCheckInSubscribe(r);let a=x.setUpDevtools(r,e);return F(N({},r),{namedSetState:a})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(r,o,i)=>(r(e.getState(o),void 0),t(r,o,i))}static compareWithShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(r,o,i)=>(o||(o=a=>a),i=i||Ct.default,t(r,o,i))}static setUpDevtools(e,t){let r;try{r=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(a){}if(!r)return a=>{e.setState(a)};let o=r.connect(x.devtoolsOptions(t));o.prefix=t?`${t} > `:"";let i=e.setState;return e.setState=a=>{i(a),o.send(`${o.prefix}setState`,e.getState())},o.subscribe(x.devtoolsSubscribe(o,e,i)),o.send("setUpStore",e.getState()),(a,c)=>{i(a);let M=c||`${o.prefix}action`;o.send(M,e.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress"]}}static devtoolsSubscribe(e,t,r){return o=>{var i,a,c,M;if(o.type==="DISPATCH"&&o.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(o.payload.type)?r(JSON.parse(o.state)):t.setState(JSON.parse(o.state));else if(o.type==="DISPATCH"&&((i=o.payload)==null?void 0:i.type)==="COMMIT")e.init(t.getState());else if(o.type==="DISPATCH"&&((a=o.payload)==null?void 0:a.type)==="IMPORT_STATE"){let R=(c=o.payload.nextLiftedState)==null?void 0:c.actionsById;(((M=o.payload.nextLiftedState)==null?void 0:M.computedStates)||[]).forEach(({state:f},w)=>{let Y=R[w]||`${e.prefix}setState`;w===0?e.init(f):(r(f),e.send(Y,t.getState()))})}}}};
